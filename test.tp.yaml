---
- name: stage1
  stages:
    - request:
        POST: http://localhost:3000/todos/
        headers:
          Content-Type: application/json
        json:
          task: 5
      asserts:
        is_true: $.resp.json.task == 5
        is_true: $.resp.status == 201
        is_false: $.resp.json.task != 5
        is_true: $.respx.nonexisting == 5 # will fail
      outputs: null

- name: TODO api testing
  stages:
    - name: fetches TODO items - GET
      request:
        GET: http://localhost:3000/todos/
      asserts:
        is_true: $.resp.status == 200
        is_array: $.resp.json.todos
      outputs:
        todoItem: $.resp.json[0]._id

#     - name:  TODO ad items - POST
#       request:
#         POST: http://localhost:3000/todos
#         headers:
#             Content-Type: application/json
#         json:
#           task: "run tests"
#       asserts:
#         - is_true: $.status == 201
#       outputs:
#         todoItem: $.resp.body.json[0]._id


#     - name: deletes TODO items - DELETE
#       request:
#         DELETE: "http://localhost:3000/todos/{{$.stages[0].outputs.todoItem}}"
#       asserts:
#         - is_empty: $.resp.body.json.todos
#         - is_string: $.resp.body.json

#     - name: Adds Todo item - POST
#       request:
#         POST: http://localhost:3000/todos
#         headers:
#           Content-Type: application/json
#         json:
#           task: "run tests"
#       asserts:
#         - is_true: $.resp.status_code == 201
#         - is_true: $.resp.body.json.task == "run tests"
#         - is_false: $.resp.body.json.completed
